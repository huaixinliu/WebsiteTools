# Android App性能优化笔记之数据库优化

#### ***By Long Luo***

Android中的App都是使用SQLite这个轻量级数据库。


数据库事务：

数据库事务（简称：事务）是数据库管理系统执行过程中的一个逻辑单位，由一个有限的数据库操作序列构成。
目录
1 概要
2 ACID性质
3 参见
4 注释
概要[编辑]

一个数据库事务通常包含了一个序列的对数据库的读/写操作。它的存在包含有以下两个目的：
为数据库操作序列提供了一个从失败中恢复到正常状态的方法，同时提供了数据库即使在异常状态下仍能保持一致性的方法。
当多个应用程序在并发访问数据库时，可以在这些应用程序之间提供一个隔离方法，以防止彼此的操作互相干扰。
当事务被提交给了DBMS（数据库管理系统），则DBMS（数据库管理系统）需要确保该事务中的所有操作都成功完成且其结果被永久保存在数据库中，如果事务中有的操作没有成功完成，则事务中的所有操作都需要被回滚，回到事务执行前的状态;同时，该事务对数据库或者其他事务的执行无影响，所有的事务都好像在独立的运行。
但在现实情况下，失败的风险很高。在一个数据库事务的执行过程中，有可能会遇上事务操作失败、数据库系统/操作系统失败，甚至是存储介质失败等情况。这便需要DBMS对一个执行失败的事务执行恢复操作，将其数据库状态恢复到一致状态（数据的一致性得到保证的状态）。为了实现将数据库状态恢复到一致状态的功能，DBMS通常需要维护事务日志以追踪事务中所有影响数据库数据的操作[1][2]。



数据库方面的优化有以下几点：

数据库语句的拼接使用StringBuilder

1. 语句的拼接使用StringBuilder代替String
这个就不多说了，简单的string相加会导致创建多个临时对象消耗性能。StringBuilder的空间预分配性能好得多。如果你对字符串的长度有大致了解，如100字符左右，可以直接new StringBuilder(128)指定初始大小，减少空间不够时的再次分配。
 
2. 读写表
在写表时调用sqliteOpenHelper..getWritableDatabase()，在读表时候调用sqliteOpenHelper..getReadableDatabase()，getReadableDatabase性能更优。
 
3. 查询时返回更少的结果集及更少的字段。
查询时只取需要的字段和结果集，更多的结果集会消耗更多的时间及内存，更多的字段会导致更多的内存消耗。
 
4. 少用cursor.getColumnIndex
根据性能调优过程中的观察cursor.getColumnIndex的时间消耗跟cursor.getInt相差无几。可以在建表的时候用static变量记住某列的index，直接调用相应index而不是每次查询。














































#### ***Long Luo Version0.1 Created at 2014/4/10 11:00:25 @Shenzhen, China.***  







